
# Z.ai API 426é”™è¯¯ä¿®å¤è¯´æ˜

## ğŸ“‹ é—®é¢˜æè¿°

åœ¨2025å¹´9æœˆ30æ—¥ï¼ŒZ.aiæ›´æ–°äº†å…¶å®¢æˆ·ç«¯éªŒè¯æœºåˆ¶ï¼Œå¯¼è‡´APIè¯·æ±‚è¿”å›426é”™è¯¯ï¼š

```json
{
  "error": {
    "detail": "Your client version check is failed",
    "code": 426
  }
}
```

## ğŸ” é—®é¢˜åˆ†æ

é€šè¿‡æµ‹è¯•å’Œåˆ†æï¼Œå‘ç°Z.aiçš„æ–°éªŒè¯æœºåˆ¶åŒ…å«ä»¥ä¸‹è¦æ±‚ï¼š

1. **å®¢æˆ·ç«¯ç‰ˆæœ¬éªŒè¯**ï¼šéœ€è¦ `X-FE-Version` header
2. **ç­¾åéªŒè¯**ï¼šéœ€è¦ `X-Signature` header
3. **User-Agentæ›´æ–°**ï¼šéœ€è¦åŒ¹é…æœ€æ–°çš„Chromeç‰ˆæœ¬

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. æ›´æ–°å‰ç«¯ç‰ˆæœ¬å·

```go
// ä» 1.0.70 æ›´æ–°åˆ° 1.0.94
X_FE_VERSION = "prod-fe-1.0.94"
```

### 2. æ›´æ–°User-Agent

```go
// ä» Chrome 139 æ›´æ–°åˆ° Chrome 140
BROWSER_UA = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
```

### 3. æ›´æ–°Sec-CH-UA

```go
// æ›´æ–°Chromeç‰ˆæœ¬ä¿¡æ¯
SEC_CH_UA = "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"Google Chrome\";v=\"140\""
```

### 4. å®ç°X-Signatureç­¾å

ç­¾åç®—æ³•åŸºäºè¯·æ±‚ä½“çš„SHA-256å“ˆå¸Œï¼š

```go
// ç”Ÿæˆ X-Signature - åŸºäºè¯·æ±‚ä½“çš„ SHA-256 å“ˆå¸Œ
hash := sha256.Sum256(reqBody)
signature := fmt.Sprintf("%x", hash)
```

## ğŸ“ ä¿®æ”¹æ–‡ä»¶

### main.go

**ä½ç½®1ï¼šå¸¸é‡å®šä¹‰ï¼ˆç¬¬78-86è¡Œï¼‰**

```go
// ä¼ªè£…å‰ç«¯å¤´éƒ¨ï¼ˆ2025-09-30 æ›´æ–°ï¼šä¿®å¤426é”™è¯¯ï¼‰
const (
	X_FE_VERSION   = "prod-fe-1.0.94" // æ›´æ–°ï¼š1.0.70 â†’ 1.0.94
	BROWSER_UA     = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36" // æ›´æ–°ï¼šChrome 139 â†’ 140
	SEC_CH_UA      = "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"Google Chrome\";v=\"140\"" // æ›´æ–°ï¼šChrome 140
	SEC_CH_UA_MOB  = "?0"
	SEC_CH_UA_PLAT = "\"Windows\""
	ORIGIN_BASE    = "https://chat.z.ai"
)
```

**ä½ç½®2ï¼šç­¾åç”Ÿæˆï¼ˆç¬¬1618-1622è¡Œï¼‰**

```go
// ç”Ÿæˆ X-Signature - åŸºäºè¯·æ±‚ä½“çš„ SHA-256 å“ˆå¸Œï¼ˆ426é”™è¯¯ä¿®å¤ï¼‰
hash := sha256.Sum256(reqBody)
signature := fmt.Sprintf("%x", hash)

debugLog("ç”Ÿæˆç­¾å: %s (åŸºäºè¯·æ±‚ä½“SHA256)", signature)
```

## ğŸ§ª æµ‹è¯•ç»“æœ

### éæµå¼å“åº”æµ‹è¯•

```bash
curl -X POST http://localhost:9090/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer 0000" \
  -d '{"model": "GLM-4.6", "messages": [{"role": "user", "content": "ä½ å¥½ï¼Œ1+1ç­‰äºå‡ ï¼Ÿ"}], "stream": false}'
```

**ç»“æœï¼šâœ… æˆåŠŸ**
```json
{
  "id": "chatcmpl-1759245369",
  "object": "chat.completion",
  "created": 1759245369,
  "model": "GLM-4.6",
  "choices": [{
    "index": 0,
    "message": {
      "role": "assistant",
      "content": "ä½ å¥½ï¼\n\n1 + 1 ç­‰äº **2**ã€‚\n\nè¿™æ˜¯ä¸€ä¸ªåŸºç¡€çš„ç®—æœ¯é—®é¢˜ã€‚å¦‚æœæ‚¨æœ‰å…¶ä»–æ•°å­¦é—®é¢˜æˆ–è€…ä»»ä½•å…¶ä»–æ–¹é¢çš„é—®é¢˜ï¼Œä¹Ÿæ¬¢è¿éšæ—¶æé—®ï¼"
    },
    "finish_reason": "stop"
  }]
}
```

### æµå¼å“åº”æµ‹è¯•

```bash
curl -X POST http://localhost:9090/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer 0000" \
  -d '{"model": "GLM-4.6", "messages": [{"role": "user", "content": "å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—"}], "stream": true}'
```

**ç»“æœï¼šâœ… æˆåŠŸ**

è¿”å›äº†å®Œæ•´çš„æµå¼SSEå“åº”ï¼Œå†…å®¹æ­£å¸¸ã€‚

## ğŸ“Š å…³é”®æ—¥å¿—

æˆåŠŸçš„è¯·æ±‚æ—¥å¿—æ˜¾ç¤ºï¼š

```
2025/09/30 23:16:07 [DEBUG] ç”Ÿæˆç­¾å: e39d78fcfa9b4926500af485388cd038c36e02529fbf82640002ee8fa07cc828 (åŸºäºè¯·æ±‚ä½“SHA256)
2025/09/30 23:16:09 [DEBUG] ä¸Šæ¸¸å“åº”çŠ¶æ€: 200 200 OK
2025/09/30 23:16:09 [DEBUG] å¼€å§‹æ”¶é›†å®Œæ•´å“åº”å†…å®¹
```

## ğŸ¯ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ è¿”å›426é”™è¯¯ï¼š"Your client version check is failed"
- âŒ æ— æ³•è·å–ä»»ä½•AIå“åº”
- âŒ æ‰€æœ‰è¯·æ±‚è¢«æ‹’ç»

### ä¿®å¤å
- âœ… è¿”å›200 OK
- âœ… æ­£å¸¸è·å–AIå“åº”
- âœ… æµå¼å’Œéæµå¼å“åº”éƒ½æ­£å¸¸å·¥ä½œ
- âœ… å®Œå…¨å…¼å®¹OpenAI APIæ ¼å¼

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **æ›´æ–°ä»£ç **
   ```bash
   git pull origin main
   ```

2. **é‡æ–°ç¼–è¯‘**
   ```bash
   go build -o ztoapi main.go simple_client.go
   ```

3. **é‡å¯æœåŠ¡**
   ```bash
   ./start.sh
   ```

4. **éªŒè¯æœåŠ¡**
   ```bash
   curl -X POST http://localhost:9090/v1/chat/completions \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer 0000" \
     -d '{"model": "GLM-4.6", "messages": [{"role": "user", "content": "ä½ å¥½"}], "stream": false}'
   ```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ç­¾åç®—æ³•åˆ†æ

Z.aiçš„ç­¾åéªŒè¯æœºåˆ¶ï¼š

1. **è¾“å…¥**ï¼šå®Œæ•´çš„JSONè¯·æ±‚ä½“
2. **å¤„ç†**ï¼šè®¡ç®—SHA-256å“ˆå¸Œ
3. **è¾“å‡º**ï¼š16è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆ64å­—ç¬¦ï¼‰
4. **ä½ç½®**ï¼š`X-Signature` HTTP header

ç¤ºä¾‹ï¼š
```
è¯·æ±‚ä½“: {"stream":true,"model":"GLM-4-6-API-V1",...}
SHA256: e39d78fcfa9b4926500af485388cd038c36e02529fbf82640002ee8fa07cc828
Header: X-Signature: e39d78fcfa9b4926500af485388cd038c36e02529fbf82640002ee8fa07cc828
```

### ç‰ˆæœ¬æ£€æµ‹æœºåˆ¶

Z.aié€šè¿‡ä»¥ä¸‹headersæ£€æµ‹å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼š

1. **X-FE-Version**: å‰ç«¯ç‰ˆæœ¬å·ï¼ˆå¿…é¡» â‰¥ 1.0.94ï¼‰
2. **User-Agent**: æµè§ˆå™¨æ ‡è¯†ï¼ˆæ¨èChrome 140+ï¼‰
3. **Sec-CH-UA**: Chromeç”¨æˆ·ä»£ç†å®¢æˆ·ç«¯æç¤º

å¦‚æœä»»ä½•ä¸€ä¸ªä¸åŒ¹é…ï¼Œå°†è¿”å›426é”™è¯¯ã€‚

## ğŸ“ ç»´æŠ¤å»ºè®®

### ç›‘æ§è¦ç‚¹

1. **å®šæœŸæ£€æŸ¥Z.aiæ›´æ–°**
   - ç‰ˆæœ¬å·å¯èƒ½ç»§ç»­å‡çº§
   - ç­¾åç®—æ³•å¯èƒ½å˜åŒ–
   - æ–°å¢éªŒè¯æœºåˆ¶

2. **æ—¥å¿—ç›‘æ§**
   - å…³æ³¨426é”™è¯¯
   - ç›‘æ§æˆåŠŸç‡
   - è®°å½•å“åº”æ—¶é—´

3. **è‡ªåŠ¨åŒ–æµ‹è¯•**
   ```bash
   # å®šæœŸè¿è¡Œæµ‹è¯•è„šæœ¬
   ./test_api.sh
   ```

### æœªæ¥å¯èƒ½çš„å˜åŒ–

Z.aiå¯èƒ½ä¼šè¿›ä¸€æ­¥åŠ å¼ºéªŒè¯ï¼š

- âš ï¸ æ›´å¤æ‚çš„ç­¾åç®—æ³•
- âš ï¸ æ·»åŠ æ—¶é—´æˆ³éªŒè¯
- âš ï¸ å®ç°è¯·æ±‚é¢‘ç‡é™åˆ¶
- âš ï¸ IPåœ°å€ç™½åå•

**åº”å¯¹ç­–ç•¥**ï¼šä¿æŒä»£ç çš„çµæ´»æ€§ï¼Œä¾¿äºå¿«é€Ÿè°ƒæ•´ã€‚

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - é¡¹ç›®ä¸»æ–‡æ¡£

## ğŸ“… æ›´æ–°æ—¥å¿—

- **2025-09-30**:
  - æˆåŠŸä¿®å¤426é”™è¯¯
  - æ›´æ–°åˆ°Chrome 140
  - å®ç°SHA-256ç­¾åéªŒè¯
  - ç‰ˆæœ¬å·æ›´æ–°è‡³1.0.94

---

**ä¿®å¤è€…**: Kilo Code
**ä¿®å¤æ—¥æœŸ**: 2025å¹´9æœˆ30æ—¥
**çŠ¶æ€**: âœ… å·²éªŒè¯å¹¶éƒ¨ç½²